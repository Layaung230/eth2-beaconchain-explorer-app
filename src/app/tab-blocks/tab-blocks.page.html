<ion-header>
	<ion-toolbar class="top">
		<ion-buttons slot="start" (click)="openDashboardAndGroupSelect()">
			<ion-icon slot="icon-only" ios="apps-outline" md="apps-outline" id="network-icon"></ion-icon>
		</ion-buttons>
		<ion-title>Blocks</ion-title>
		<ion-buttons slot="end">
			<ion-button
				(click)="unit.switchCurrencyPipe()"
				*ngIf="(unit.pref.Exec.value != 'ETHER' && unit.pref.Exec.value != 'FINNEY') || classReference.currencyPipe.Exec != null ">
				<ion-icon size="small" name="swap-vertical-outline"></ion-icon>
			</ion-button>
		</ion-buttons>
	</ion-toolbar>

	<ion-item class="top-bar" *ngIf="!initialLoading && dataSource && dataSource.hasItems()">
		<ion-label class="top-bar-inner"
			>Proposal Luck: 
			<span style="padding-left: 2px;" *ngIf="summaryGroup() && summaryGroup().luck.proposal.percent" [class]="summaryGroup().luck.proposal.percent | valuestyle: 100"
				>{{ summaryGroup().luck.proposal.percent | number:'1.0-1' }}%</span
			>
			<span *ngIf="!summaryGroup()">-</span>
		</ion-label>

		<ion-icon class="opacity-icon top-bar-inner" slot="end" name="help-circle-outline" (click)="luckHelp()"></ion-icon>
	</ion-item>
</ion-header>

<ion-content [fullscreen]="true" role="feed" [scrollY]="false">
	<ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
		<ion-refresher-content></ion-refresher-content>
	</ion-refresher>

	<app-full-page-loading [renderWait]="20" [loading]="initialLoading">

		<p class="next-block-hint" *ngIf="summaryGroup() && !initialLoading && dataSource && dataSource.hasItems()">
			<span *ngIf="!(expectedNextBlockTs() | timeago).includes('ago')">On average, next block expected in</span>
			<span *ngIf="(expectedNextBlockTs() | timeago).includes('ago')">On average, next block was expected</span>
			<br />
			<span style="font-style: normal">~{{ expectedNextBlockTs() | timeago }} </span>
		</p>

		<app-ad location="blocks" *ngIf="dataSource && dataSource.hasItems() && !initialLoading"></app-ad>

		<div class="nothingfound" *ngIf="(!dataSource || dataSource && !dataSource.hasItems()) && !initialLoading && initialized">
			<ion-icon name="telescope-outline"></ion-icon>
			<h2>No Blocks so far</h2>
			<ion-label>Your proposed blocks will show up here.</ion-label>
		</div>

		<cdk-virtual-scroll-viewport
			itemSize="89"
			minBufferPx="1200"
			maxBufferPx="1600"
			class="ion-content-scroll-host"
			[hidden]="!dataSource || !dataSource.hasItems() || initialLoading">
			<div *cdkVirtualFor="let item of dataSource; index as idx " style="background-color: var(--ion-card-background)">
				<app-block [block]="item" [first]="idx == 0" [last]="idx == dataSource.cachedData.length - 1" (click)="clickBlock(item)" role="article"></app-block>
			</div>
			<div style="text-align: center; padding-top: 10px; padding-bottom: 70px" *ngIf="loadMore">
				<i style="letter-spacing: 0.9px; opacity: 0.8">Loading...</i>
			</div>
		</cdk-virtual-scroll-viewport>
	</app-full-page-loading>
</ion-content>
